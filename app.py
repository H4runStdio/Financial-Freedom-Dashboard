# -*- coding: utf-8 -*-
"""Untitled5.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kATdG-CnZhtrEJyT2j9GTVhkUQACXF9R
"""

import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# ===============================
# PAGE CONFIG
# ===============================
st.set_page_config(
    page_title="Financial Freedom Consultant",
    layout="wide"
)

# ===============================
# GLOBAL STYLE (DARK PROFESSIONAL DASHBOARD)
# ===============================
st.markdown("""
<style>
html, body, [class*="css"] {
    font-family: 'Segoe UI', sans-serif;
    background-color: #0b0f19;
    color: #e5e7eb;
}

[data-testid="stSidebar"] {
    background-color: #111827;
}

.dashboard-card {
    background-color: #111827;
    border: 1px solid #1f2937;
    border-radius: 14px;
    padding: 18px;
    text-align: center;
}

.card-title {
    font-size: 13px;
    color: #9ca3af;
}

.card-value {
    font-size: 22px;
    font-weight: 600;
    color: #f9fafb;
}

.section-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
}

hr {
    border: none;
    border-top: 1px solid #1f2937;
    margin: 25px 0;
}
</style>
""", unsafe_allow_html=True)

plt.style.use("dark_background")

# ===============================
# HEADER
# ===============================
st.markdown("## ðŸ’¼ Financial Freedom Consultant")
st.caption("Professional financial planning dashboard for long term wealth and passive income")

st.markdown("<hr>", unsafe_allow_html=True)

# ===============================
# SIDEBAR INPUT
# ===============================
st.sidebar.markdown("## ðŸ“Œ User Profile")

usia_sekarang = st.sidebar.number_input(
    "Usia saat ini",
    min_value=18,
    max_value=80,
    value=None,
    placeholder="Contoh: 25"
)

usia_target = st.sidebar.number_input(
    "Target usia financial freedom",
    min_value=18,
    max_value=100,
    value=None,
    placeholder="Contoh: 50"
)

target_aset = st.sidebar.number_input(
    "Target aset saat financial freedom (Rp)",
    min_value=0,
    value=None,
    step=100_000_000,
    placeholder="Contoh: 3000000000"
)

profil_investor = st.sidebar.selectbox(
    "Profil investor",
    ["", "Konservatif", "Moderat", "Agresif"]
)

expert_mode = st.sidebar.checkbox("Aktifkan Expert Mode")

# ===============================
# VALIDATION
# ===============================
if not all([usia_sekarang, usia_target, target_aset, profil_investor]):
    st.info("Lengkapi seluruh input di sidebar untuk menampilkan dashboard.")
    st.stop()

if usia_target <= usia_sekarang:
    st.error("Target usia harus lebih besar dari usia saat ini.")
    st.stop()

# ===============================
# ASSUMPTIONS
# ===============================
return_map = {
    "Konservatif": 0.07,
    "Moderat": 0.11,
    "Agresif": 0.16
}

expected_return = return_map[profil_investor]
horizon = usia_target - usia_sekarang
months = horizon * 12
monthly_rate = expected_return / 12

import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from reportlab.platypus import SimpleDocTemplate, Paragraph
from reportlab.lib.styles import getSampleStyleSheet
import io

# ===============================
# PAGE CONFIG
# ===============================
st.set_page_config(page_title="Financial Freedom Consultant", layout="wide")

# ===============================
# MODE TOGGLE
# ===============================
dark_mode = st.toggle("ðŸŒ™ Dark Mode", value=True)

if dark_mode:
    bg, card, border, text = "#0b0f19", "#111827", "#1f2937", "#e5e7eb"
    plt.style.use("dark_background")
else:
    bg, card, border, text = "#f9fafb", "#ffffff", "#e5e7eb", "#111827"
    plt.style.use("default")

# ===============================
# GLOBAL CSS
# ===============================
st.markdown(f"""
<style>
html, body {{ background-color:{bg}; color:{text}; }}
[data-testid="stSidebar"] {{ background-color:{card}; }}
.dashboard-card {{
    background:{card}; border:1px solid {border};
    border-radius:14px; padding:18px; text-align:center;
}}
.card-title {{ font-size:13px; color:#9ca3af; }}
.card-value {{ font-size:22px; font-weight:600; }}
</style>
""", unsafe_allow_html=True)

# ===============================
# HEADER
# ===============================
st.markdown("## ðŸ’¼ Financial Freedom Consultant Dashboard")
st.caption("Advanced interactive financial planning dashboard")

# ===============================
# SIDEBAR INPUT
# ===============================
st.sidebar.header("ðŸ“Œ Profil Pengguna")

usia_sekarang = st.sidebar.number_input("Usia saat ini", 18, 80, value=None)
usia_target = st.sidebar.number_input("Target usia financial freedom", 18, 100, value=None)
target_aset = st.sidebar.number_input("Target aset (Rp)", value=None, step=100_000_000)
profil = st.sidebar.selectbox("Profil investor", ["", "Konservatif", "Moderat", "Agresif"])

if not all([usia_sekarang, usia_target, target_aset, profil]):
    st.info("Lengkapi seluruh input di sidebar.")
    st.stop()

# ===============================
# RETURN SLIDER
# ===============================
return_ranges = {
    "Konservatif": (0.05, 0.09),
    "Moderat": (0.08, 0.14),
    "Agresif": (0.13, 0.19)
}
r_min, r_max = return_ranges[profil]

expected_return = st.slider(
    "ðŸŽ› Asumsi return tahunan",
    r_min, r_max, (r_min + r_max) / 2, 0.001, format="%.2f"
)

# ===============================
# CORE CALCULATION
# ===============================
horizon = usia_target - usia_sekarang
months = horizon * 12
monthly_rate = expected_return / 12

monthly_invest = target_aset * monthly_rate / ((1 + monthly_rate) ** months - 1)

balance, balances, invested, ages = 0, [], [], []
total_inv = 0

for year in range(1, horizon + 1):
    for _ in range(12):
        balance = balance * (1 + monthly_rate) + monthly_invest
        total_inv += monthly_invest
    balances.append(balance)
    invested.append(total_inv)
    ages.append(usia_sekarang + year)

df = pd.DataFrame({"Usia": ages, "Aset": balances, "Dana Disetor": invested})

# ===============================
# KPI CARDS
# ===============================
c1, c2, c3, c4 = st.columns(4)

def card(col, title, value):
    col.markdown(f"""
    <div class="dashboard-card">
        <div class="card-title">{title}</div>
        <div class="card-value">{value}</div>
    </div>
    """, unsafe_allow_html=True)

card(c1, "Target Usia", f"{usia_target} tahun")
card(c2, "Profil Investor", profil)
card(c3, "Return Tahunan", f"{expected_return*100:.2f}%")
card(c4, "Investasi Bulanan", f"Rp {monthly_invest:,.0f}")

# ===============================
# GRAFIK UTAMA
# ===============================
g1, g2 = st.columns(2)

fig1, ax1 = plt.subplots()
ax1.plot(df["Usia"], df["Aset"], linewidth=3)
ax1.scatter(df["Usia"].iloc[-1], df["Aset"].iloc[-1], s=60)
ax1.set_title("Pertumbuhan Aset")
ax1.text(df["Usia"].iloc[-1], df["Aset"].iloc[-1],
         f" Rp {df['Aset'].iloc[-1]:,.0f}")
g1.pyplot(fig1)

fig2, ax2 = plt.subplots()
ax2.plot(df["Usia"], df["Dana Disetor"], label="Dana Disetor")
ax2.plot(df["Usia"], df["Aset"], label="Total Aset")
ax2.legend()
ax2.set_title("Dana Disetor vs Hasil Investasi")
g2.pyplot(fig2)

# ===============================
# SCENARIO TABLE
# ===============================
scenario = []
for name, r in {"Pesimis": expected_return-0.03,
                "Base": expected_return,
                "Optimis": expected_return+0.03}.items():
    bal = 0
    for _ in range(months):
        bal = bal * (1 + r/12) + monthly_invest
    scenario.append([name, f"{r*100:.1f}%", f"Rp {bal:,.0f}"])

st.subheader("ðŸ“‹ Scenario Analysis")
st.dataframe(pd.DataFrame(
    scenario, columns=["Skenario", "Return", "Aset Akhir"]),
    use_container_width=True)

# ===============================
# MONTE CARLO
# ===============================
st.subheader("ðŸŽ² Monte Carlo Simulation")

n_sim = 3000
results = []

for _ in range(n_sim):
    bal = 0
    for _ in range(months):
        r = np.random.normal(expected_return, 0.04) / 12
        bal = bal * (1 + r) + monthly_invest
    results.append(bal)

results = np.array(results)
prob = (results >= target_aset).mean()

fig_mc, ax_mc = plt.subplots()
ax_mc.hist(results, bins=40)
ax_mc.axvline(target_aset)
ax_mc.set_title("Distribusi Aset Akhir")
st.pyplot(fig_mc)

st.metric("Probability of Success", f"{prob*100:.1f}%")

# ===============================
# PASSIVE INCOME + ALLOCATION
# ===============================
st.subheader("ðŸ’¸ Pendapatan Pasif & Alokasi Aset")

yield_obl = st.slider("Yield obligasi (%)", 3.0, 12.0, 6.0) / 100
monthly_income = target_aset * yield_obl / 12

p1, p2 = st.columns(2)
card(p1, "Pendapatan Bulanan", f"Rp {monthly_income:,.0f}")
card(p2, "Total Aset", f"Rp {target_aset:,.0f}")

fig_alloc, ax_alloc = plt.subplots()
ax_alloc.pie([70, 20, 10],
             labels=["Obligasi", "Dividen Saham", "Kas"],
             autopct="%1.0f%%")
ax_alloc.set_title("Ilustrasi Alokasi Aset Pasca-FF")
st.pyplot(fig_alloc)

# ===============================
# EXPORT PDF
# ===============================
st.subheader("ðŸ“„ Export Financial Report")

if st.button("Download PDF Report"):
    buffer = io.BytesIO()
    doc = SimpleDocTemplate(buffer)
    styles = getSampleStyleSheet()
    content = [
        Paragraph("Financial Freedom Report", styles["Title"]),
        Paragraph(f"Profil Investor: {profil}", styles["Normal"]),
        Paragraph(f"Target Usia: {usia_target}", styles["Normal"]),
        Paragraph(f"Target Aset: Rp {target_aset:,.0f}", styles["Normal"]),
        Paragraph(f"Investasi Bulanan: Rp {monthly_invest:,.0f}", styles["Normal"]),
        Paragraph(f"Probability of Success: {prob*100:.1f}%", styles["Normal"])
    ]
    doc.build(content)
    st.download_button(
        "Klik untuk download",
        buffer.getvalue(),
        "financial_report.pdf",
        "application/pdf"
    )

# ===============================
# DISCLAIMER
# ===============================
st.caption("Disclaimer: Aplikasi ini bersifat edukatif dan bukan nasihat investasi.")
