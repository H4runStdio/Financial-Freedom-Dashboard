# -*- coding: utf-8 -*-
"""Untitled5.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kATdG-CnZhtrEJyT2j9GTVhkUQACXF9R
"""

import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# ===============================
# KONFIGURASI HALAMAN
# ===============================
st.set_page_config(
    page_title="Financial Freedom Consultant",
    layout="wide"
)

st.title("ğŸ’¼ Personal Financial Freedom Consultant Dashboard")
st.caption("Simulasi perencanaan keuangan jangka panjang berbasis profil investor")

# ===============================
# SIDEBAR INPUT USER
# ===============================
st.sidebar.header("ğŸ“Œ Profil Pengguna")

usia_sekarang = st.sidebar.number_input(
    "Usia saat ini",
    min_value=18,
    max_value=80,
    value=25
)

usia_target = st.sidebar.number_input(
    "Target usia financial freedom",
    min_value=usia_sekarang + 1,
    max_value=100,
    value=50
)

target_aset = st.sidebar.number_input(
    "Target aset saat financial freedom (Rp)",
    min_value=100_000_000,
    value=3_000_000_000,
    step=100_000_000
)

profil_investor = st.sidebar.selectbox(
    "Profil investor",
    ["Konservatif", "Moderat", "Agresif"]
)

expert_mode = st.sidebar.checkbox("Aktifkan Expert Mode")

# ===============================
# ASUMSI RETURN BERDASARKAN PROFIL
# ===============================
if profil_investor == "Konservatif":
    expected_return = 0.07
elif profil_investor == "Moderat":
    expected_return = 0.11
else:
    expected_return = 0.16

horizon = usia_target - usia_sekarang

# ===============================
# HITUNG INVESTASI BULANAN
# ===============================
monthly_rate = expected_return / 12
months = horizon * 12

monthly_investment = target_aset * monthly_rate / ((1 + monthly_rate) ** months - 1)

# ===============================
# SIMULASI PERTUMBUHAN ASET
# ===============================
balance = 0
balances = []
years = []

for year in range(1, horizon + 1):
    for _ in range(12):
        balance = balance * (1 + monthly_rate) + monthly_investment
    balances.append(balance)
    years.append(usia_sekarang + year)

df_growth = pd.DataFrame({
    "Usia": years,
    "Aset": balances
})

# ===============================
# KPI DASHBOARD
# ===============================
col1, col2, col3, col4 = st.columns(4)

col1.metric("Target Usia FF", f"{usia_target} tahun")
col2.metric("Profil Investor", profil_investor)
col3.metric("Return Tahunan", f"{expected_return*100:.1f}%")
col4.metric("Investasi Bulanan", f"Rp {monthly_investment:,.0f}")

# ===============================
# GRAFIK PERTUMBUHAN ASET
# ===============================
st.subheader("ğŸ“ˆ Proyeksi Pertumbuhan Aset")

fig, ax = plt.subplots()
ax.plot(df_growth["Usia"], df_growth["Aset"])
ax.axhline(target_aset, linestyle="--")
ax.set_xlabel("Usia")
ax.set_ylabel("Nilai Aset (Rp)")
st.pyplot(fig)

# ===============================
# INSIGHT KONSULTAN
# ===============================
st.subheader("ğŸ§  Insight Konsultan")

if monthly_investment > 0.5 * target_aset / months:
    st.warning(
        "Target ini tergolong agresif. Pertimbangkan memperpanjang usia target "
        "atau meningkatkan profil risiko."
    )
else:
    st.success(
        "Target financial freedom ini tergolong realistis dengan asumsi yang digunakan."
    )

# ===============================
# EXPERT MODE
# ===============================
if expert_mode:
    st.subheader("ğŸ” Expert Analysis")

    st.markdown("**Scenario Analysis**")

    scenarios = {
        "Pesimis": expected_return - 0.03,
        "Base Case": expected_return,
        "Optimis": expected_return + 0.03
    }

    scenario_results = []

    for name, r in scenarios.items():
        rate = r / 12
        bal = 0
        for _ in range(months):
            bal = bal * (1 + rate) + monthly_investment
        scenario_results.append([name, bal])

    df_scenario = pd.DataFrame(
        scenario_results,
        columns=["Skenario", "Aset Akhir"]
    )

    st.dataframe(df_scenario)

# ===============================
# FASE PENDAPATAN PASIF
# ===============================
st.subheader("ğŸ’¸ Simulasi Pendapatan Pasif Setelah Financial Freedom")

yield_obligasi = st.slider(
    "Asumsi yield obligasi tahunan (%)",
    min_value=3.0,
    max_value=8.0,
    value=6.0
) / 100

pendapatan_tahunan = target_aset * yield_obligasi
pendapatan_bulanan = pendapatan_tahunan / 12

colA, colB, colC = st.columns(3)

colA.metric("Total Aset", f"Rp {target_aset:,.0f}")
colB.metric("Pendapatan Tahunan", f"Rp {pendapatan_tahunan:,.0f}")
colC.metric("Pendapatan Bulanan", f"Rp {pendapatan_bulanan:,.0f}")

st.info(
    "Dengan menginvestasikan seluruh aset pada obligasi dan menggunakan "
    "kupon sebagai pendapatan, nilai pokok aset tetap terjaga."
)

# ===============================
# DISCLAIMER
# ===============================
st.caption(
    "Disclaimer: Aplikasi ini bersifat edukatif dan bukan merupakan nasihat investasi pribadi."
)